# –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ Office Scene

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ

1. **InstancedWindow –¥–ª—è –∫—Ä—É–≥–æ–≤—ã—Ö –æ–∫–æ–Ω** ‚úÖ
   - `WINDOW_POSITIONS` (40+ –æ–∫–æ–Ω) –∏—Å–ø–æ–ª—å–∑—É—é—Ç `InstancedWindow`
   - –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç draw calls —Å 40+ –¥–æ 1-2

2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã** ‚úÖ
   - `TABLE_POSITIONS`, `WALL_POSITION`, `WINDOW_POSITIONS` –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
   - –£–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

3. **Canvas –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω** ‚úÖ
   - `antialias: false`
   - `dpr={[1,1.5]}` - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π DPR
   - `performance` –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - `frameloop="demand"`

4. **–°—Ç–µ–Ω—ã –∏ —Å—Ç–æ–ª—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã** ‚úÖ
   - –í—Å–µ —Å—Ç–µ–Ω—ã –≤ –æ–¥–Ω–æ–º `RigidBody`
   - –í—Å–µ —Å—Ç–æ–ª—ã –≤ –æ–¥–Ω–æ–º `RigidBody` —Å –∫–æ–ª–ª–∞–π–¥–µ—Ä–∞–º–∏

5. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** ‚úÖ
   - `useCachedModel` —Ö—É–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `ItemRender`
   - –°–Ω–∏–∂–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–µ–π

6. **–¢–µ–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã** ‚úÖ
   - `shadow-mapSize={[2048,2048]}`
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞–º–µ—Ä—ã —Ç–µ–Ω–µ–π

---

## ‚ö†Ô∏è –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

### 1. –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö WindowFrameObject (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Å—Ü–µ–Ω–µ –µ—â–µ ~80+ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `WindowFrameObject` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- –°—Ç—Ä–æ–∫–∏ 293-319: –ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω—ã–µ (16 –æ–∫–æ–Ω)
- –°—Ç—Ä–æ–∫–∏ 427-436: –ó–∞–¥–Ω—è—è —á–∞—Å—Ç—å (8 –æ–∫–æ–Ω)
- –°—Ç—Ä–æ–∫–∏ 446-477: –ö–æ—Ä–∏–¥–æ—Ä (32 –æ–∫–Ω–∞)
- –°—Ç—Ä–æ–∫–∏ 511-543: –ö–∞–±–∏–Ω–µ—Ç –û–ª–µ–≥–∞ (30 –æ–∫–æ–Ω)

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –æ–∫–æ–Ω –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `InstancedWindow`

**–ö–æ–¥ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```tsx
// –í office-scene-config.ts –¥–æ–±–∞–≤–∏—Ç—å:
export const ALL_WINDOW_POSITIONS: MapItemProps[] = [
  // –ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω—ã–µ
  { position: [-25.1,1.6,18.8], scale: [20,28,19], color: 'Black' },
  { position: [-25.1,1.6,16.8], scale: [20,28,19], color: 'White' },
  { position: [-25.1,1.6,14.8], scale: [20,28,19], color: 'White' },
  { position: [-25.1,1.6,12.8], scale: [20,28,19], color: 'White' },
  { position: [-25.05,6,18.8], scale: [20,27.5,19], rotation: [0,0,Math.PI / -5], color: 'Black' },
  { position: [-25.05,6,16.8], scale: [20,27.5,19], rotation: [0,0,Math.PI / -5], color: 'White' },
  { position: [-25.05,6,14.8], scale: [20,27.5,19], rotation: [0,0,Math.PI / -5], color: 'White' },
  { position: [-25.05,6,12.8], scale: [20,27.5,19], rotation: [0,0,Math.PI / -5], color: 'White' },
  
  { position: [-25.1,1.6,10.3], scale: [20,28,20.5], color: 'Black' },
  { position: [-25.1,1.6,8.15], scale: [20,28,20.5], color: 'White' },
  { position: [-25.1,1.6,6], scale: [20,28,20.5], color: 'White' },
  { position: [-25.1,1.6,3.85], scale: [20,28,20.5], color: 'White' },
  { position: [-25.05,6,10.3], scale: [20,27.5,20.5], rotation: [0,0,Math.PI / -5], color: 'Black' },
  { position: [-25.05,6,8.15], scale: [20,27.5,20.6], rotation: [0,0,Math.PI / -5], color: 'White' },
  { position: [-25.05,6,6], scale: [20,27.5,20.5], rotation: [0,0,Math.PI / -5], color: 'White' },
  { position: [-25.05,6,3.85], scale: [20,27.5,20.5], rotation: [0,0,Math.PI / -5], color: 'White' },
  
  { position: [-25.1,1.6,1.2], scale: [20,28,21.5], color: 'Black' },
  { position: [-25.1,1.6,-1.05], scale: [20,28,21.5], color: 'White' },
  { position: [-25.1,1.6,-3.3], scale: [20,28,21.5], color: 'White' },
  { position: [-25.1,1.6, -5.55], scale: [20,28,21.5], color: 'Black' },
  { position: [-25.05,6,1.2], scale: [20,27.5,21.5], rotation: [0,0,Math.PI / -5], color: 'Black' },
  { position: [-25.05,6,-1.05], scale: [20,27.5,21.5], rotation: [0,0,Math.PI / -5], color: 'White' },
  { position: [-25.05,6,-3.3], scale: [20,27.5,21.5], rotation: [0,0,Math.PI / -5], color: 'White' },
  { position: [-25.05,6,-5.55], scale: [20,27.5,21.5], rotation: [0,0,Math.PI / -5], color: 'Black' },
  
  // –ó–∞–¥–Ω—è—è —á–∞—Å—Ç—å
  { position: [-19,1.6,-8.3], scale: [20,25, 19], color: 'Black' },
  { position: [-19,1.6,-10.3], scale: [20,25, 19], color: 'Black' },
  { position: [-19,1.6,-12.3], scale: [20,25, 19], color: 'Black' },
  { position: [-19,1.6,-14.3], scale: [20,25, 19], color: 'Black' },
  { position: [-19,5.5,-8.3], scale: [20,25, 19], color: 'Black' },
  { position: [-19,5.5,-10.3], scale: [20,25, 19], color: 'Black' },
  { position: [-19,5.5,-12.3], scale: [20,25, 19], color: 'Black' },
  { position: [-19,5.5,-14.3], scale: [20,25, 19], color: 'Black' },
  
  // –ö–æ—Ä–∏–¥–æ—Ä –∏ –ö–∞–±–∏–Ω–µ—Ç –û–ª–µ–≥–∞ - –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
  // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞)
];

// –í office-scene.tsx –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≥—Ä—É–ø–ø—ã WindowFrameObject –Ω–∞:
<InstancedWindow instances={ALL_WINDOW_POSITIONS.map(w => ({
  position: w.position,
  rotation: w.rotation,
  scale: w.scale,
  color: w.color || 'White'
}))} />
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ draw calls –µ—â–µ –Ω–∞ 80+ (—Å ~80 –¥–æ 2-3). –£–ª—É—á—à–µ–Ω–∏–µ FPS –Ω–∞ 20-30%.

---

### 2. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ RigidBody –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `RigidBody`, –Ω–æ –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å —Ñ–∏–∑–∏–∫–æ–π:
- –°—Ç—Ä–æ–∫–∏ 234-254: `Office-Shelf`, `trashBucket`, —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–µ —Å—Ç–µ–Ω—ã
- –°—Ç—Ä–æ–∫–∏ 277-282: `MeetingTable` –±–µ–∑ —Ñ–∏–∑–∏–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å `RigidBody` –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –±–µ–∑ —Ñ–∏–∑–∏–∫–∏

**–ö–æ–¥ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```tsx
// –ë—ã–ª–æ:
<RigidBody type="fixed">
  <ItemRender itemName="Office-Shelf" scale={3.5} position={[3,-1,9.7]} rotation={[0,Math.PI / 2,0]}/>
</RigidBody>

// –°—Ç–∞–ª–æ:
<ItemRender itemName="Office-Shelf" scale={3.5} position={[3,-1,9.7]} rotation={[0,Math.PI / 2,0]}/>
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ç–µ–ª –Ω–∞ 30-40%. –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∏–∑–∏–∫–∏ –Ω–∞ 15-20%.

---

### 3. –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö RigidBody –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –º–µ—à–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `RigidBody` –¥–ª—è —Å—Ç–æ–ª–±–æ–≤ –∏ –ø–æ–ª–æ–≤:
- –°—Ç—Ä–æ–∫–∏ 152-231: 10+ —Å—Ç–æ–ª–±–æ–≤
- –°—Ç—Ä–æ–∫–∏ 380-413: 5+ –ø–æ–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω `RigidBody` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–ª–ª–∞–π–¥–µ—Ä–∞–º–∏

**–ö–æ–¥ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```tsx
// –°—Ç–æ–ª–±—ã
<RigidBody type="fixed">
  {[
    [3.65,4.2,11.65],
    [-18,4.2,-6.5],
    [-18,4.2,11.65],
    [3.65,4.2,-6.5],
    [3.65,4.2,-19],
    [-18,4.2,-19],
    [3.65,4.2,-30],
    [3.65,4.2,-32],
    [-18,4.2,-32],
    [17,4.2,2.02],
    [26,4.2,-19],
    [26,4.2,-32],
  ].map((pos, i) => (
    <group key={i}>
      <mesh position={pos as [number, number, number]}>
        <boxGeometry args={[1.5,10.5,1.5]}/>
        <meshStandardMaterial color="#FFFFFFF"/>
      </mesh>
      <CuboidCollider args={[0.75, 5.25, 0.75]} position={pos as [number, number, number]} />
    </group>
  ))}
</RigidBody>
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ç–µ–ª –Ω–∞ 15-20. –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∏–∑–∏–∫–∏ –Ω–∞ 10-15%.

---

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ–±—ä–µ–∫—Ç–æ–≤ (–ª–∞–º–ø—ã, —Å—Ç—É–ª—å—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ:
- –°—Ç—Ä–æ–∫–∏ 326-329: 4 –ª–∞–º–ø—ã `HangingLamp`
- –°—Ç—Ä–æ–∫–∏ 334-343: 8 —Å—Ç—É–ª—å–µ–≤ `DinnerChair`
- –°—Ç—Ä–æ–∫–∏ 366-372: 6 —Å—Ç—É–ª—å–µ–≤ `DinnerBarChair`

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `InstancedLamp`, `InstancedChair` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–ª–∞–º–ø—ã –∏ —Å—Ç—É–ª—å—è –Ω–µ —Ç–∞–∫ –∫—Ä–∏—Ç–∏—á–Ω—ã, –∫–∞–∫ –æ–∫–Ω–∞)

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ InstancedWindow –¥–ª—è –∫—Ä—É–≥–æ–≤—ã—Ö –æ–∫–æ–Ω (40 –æ–∫–æ–Ω)
- ‚úÖ Canvas –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –°—Ç–µ–Ω—ã –∏ —Å—Ç–æ–ª—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
- ‚úÖ InstancedWindow –¥–ª—è –í–°–ï–• –æ–∫–æ–Ω (~120 –æ–∫–æ–Ω –≤–º–µ—Å—Ç–æ 40)
- ‚úÖ –£–±—Ä–∞–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ RigidBody (~50 –æ–±—ä–µ–∫—Ç–æ–≤)
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –ø—Ä–æ—Å—Ç—ã–µ –º–µ—à–∏ (~15 –æ–±—ä–µ–∫—Ç–æ–≤)

### –ú–µ—Ç—Ä–∏–∫–∏:
- **Draw Calls:** –°–Ω–∏–∂–µ–Ω–∏–µ —Å ~250 –¥–æ ~80-100 (60-70% —É–ª—É—á—à–µ–Ω–∏–µ)
- **FPS:** –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 30-50% (—Å 30-40 –¥–æ 50-60+ FPS)
- **–§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ç–µ–ª–∞:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 40-50% (—Å ~150 –¥–æ ~80)
- **–ü–∞–º—è—Ç—å:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 20-30% –∑–∞ —Å—á–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å):
1. ‚úÖ –ò–Ω—Å—Ç–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–∫–Ω–∞ (–∫—Ä–æ–º–µ –∫—Ä—É–≥–æ–≤—ã—Ö)
2. ‚úÖ –£–±—Ä–∞—Ç—å RigidBody –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
3. ‚úÖ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å—Ç–æ–ª–±—ã –∏ –ø–æ–ª—ã –≤ –æ–¥–∏–Ω RigidBody

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å –ø–æ–∑–∂–µ):
4. –ò–Ω—Å—Ç–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –ª–∞–º–ø—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. –ò–Ω—Å—Ç–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—É–ª—å—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
6. LOD –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
7. Frustum culling –¥–ª—è –¥–∞–ª—å–Ω–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤

---

## ‚úÖ –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å

**–î–∞, `windowCircle` –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å!**

–û–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫:
- `InstancedWindow` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —Å `WINDOW_POSITIONS` (—Å—Ç—Ä–æ–∫–∞ 438)
- `windowCircle` –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–æ–¥–µ (—É–∂–µ —É–¥–∞–ª–µ–Ω–∞ –∏–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞)

–ï—Å–ª–∏ –æ–Ω–∞ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –≥–¥–µ-—Ç–æ –≤ –∫–æ–¥–µ, –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å.

